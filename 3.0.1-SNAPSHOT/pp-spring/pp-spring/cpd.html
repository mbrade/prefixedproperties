<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Jun 28, 2015 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Prefixed Properties - CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20150628" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://maven.apache.org/" id="bannerLeft">
                                        <img src="http://maven.apache.org/images/apache-maven-project.png" alt="Maven" />
                </a>
                          <div id="bannerRight">
                                        <img src="http://maven.apache.org/images/maven-small.gif" alt="Maven" />
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2015-06-28</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/mbrade/prefixedproperties/issues" class="externalLink" title="Issue Management">Issue Management</a>
              
                    
                 <span id="projectVersion">Version: 3.0.1-SNAPSHOT</span>
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Prefixed Properties</h5>
                  <ul>
                  <li class="none">
                          <a href="../../index.html" title="Introduction">Introduction</a>
            </li>
                  <li class="none">
                          <a href="../../environments.html" title="Basic Environments">Basic Environments</a>
            </li>
                  <li class="none">
                          <a href="../../fallback.html" title="Fallbacks">Fallbacks</a>
            </li>
                  <li class="none">
                          <a href="../../cascading.html" title="Cascading Environments">Cascading Environments</a>
            </li>
                  <li class="none">
                          <a href="../../prefixconfig.html" title="Prefix Configurations">Prefix Configurations</a>
            </li>
                  <li class="none">
                          <a href="../../request.html" title="Request depended properties">Request depended properties</a>
            </li>
                  <li class="none">
                          <a href="../../spring.html" title="Spring and PrefixedProperties">Spring and PrefixedProperties</a>
            </li>
                  <li class="none">
                          <a href="../../bundle.html" title="Prefixed ResourceBundle">Prefixed ResourceBundle</a>
            </li>
                  <li class="none">
                          <a href="../../dependency.html" title="Maven Dependency">Maven Dependency</a>
            </li>
          </ul>
                                 <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../../index.html" title="PrefixedProperties">PrefixedProperties</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                                                                              <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                              <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
                          <a href="findbugs.html" title="FindBugs Report">FindBugs Report</a>
            </li>
                      <li class="none">
                          <a href="cobertura/index.html" title="Cobertura Test Coverage">Cobertura Test Coverage</a>
            </li>
                      <li class="none">
                          <a href="checkstyle.html" title="Checkstyle">Checkstyle</a>
            </li>
                      <li class="none">
                          <a href="apidocs/index.html" title="JavaDocs">JavaDocs</a>
            </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="github-report.html" title="GitHub Report">GitHub Report</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>Sub Modules</h5>
                                       <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.2.5.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesPlaceholderConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesPlaceholderConfigurer.html#175">175</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertyOverrideConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertyOverrideConfigurer.html#146">146</a></td></tr><tr class="b"><td colspan='2'><div><pre>    }

    public boolean isMixDefaultAndLocalPrefixConfigurations() {
	return mixDefaultAndLocalPrefixConfigurations;
    }

    /**
     * Load properties.
     * 
     * @param props
     *            the props
     * @throws IOException
     *             Signals that an I/O exception has occurred.
     */
    @Override
    protected void loadProperties(final Properties props) throws IOException {
	if (locations != null) {
	    for (int i = 0; i &lt; locations.length; i++) {
		final Resource location = locations[i];
		if (logger.isInfoEnabled()) {
		    logger.info(&quot;Loading properties file from &quot; + location);
		}
		File file = null;
		InputStream is = null;
		try {
		    try {
			file = location.getFile();
			is = new BufferedInputStream(new FileInputStream(file));
		    } catch (final IOException ie) {//ignore
		    } finally {
			if (file == null) {
			    is = location.getInputStream();
			}
		    }

		    if (location.getFilename().toLowerCase().endsWith(Constants.XML_FILE_EXTENSION)) {
			persister.loadFromXml(props, is);
		    } else if (location.getFilename().toLowerCase().endsWith(Constants.JSON_FILE_EXTENSION)) {
			if (fileEncoding != null) {
			    persister.loadFromJson(props, new InputStreamReader(is, Charset.forName(fileEncoding)));
			} else {
			    persister.loadFromJson(props, is);
			}
		    } else {
			if (fileEncoding != null) {
			    persister.load(props, new InputStreamReader(is, Charset.forName(fileEncoding)));
			} else {
			    persister.load(props, is);
			}
		    }
		} catch (final IOException ex) {
		    if (ignoreResourceNotFound) {
			if (logger.isWarnEnabled()) {
			    logger.warn(&quot;Could not load properties from &quot; + location + &quot;: &quot; + ex.getMessage());
			}
		    } else {
			throw ex;
		    }
		} finally {
		    if (is != null) {
			is.close();
		    }
		}
	    }
	}
    }

    /* (non-Javadoc)
     * @see org.springframework.core.io.support.PropertiesLoaderSupport#mergeProperties()
     */
    @Override
    protected Properties mergeProperties() throws IOException {
	final PrefixedProperties myProperties = createProperties();
	if (localOverride) {
	    loadProperties(myProperties);
	}

	if (localProperties != null) {
	    for (int i = 0; i &lt; localProperties.length; i++) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesPlaceholderConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesPlaceholderConfigurer.html#104">104</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertyOverrideConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertyOverrideConfigurer.html#85">85</a></td></tr><tr class="b"><td colspan='2'><div><pre>    private boolean mixDefaultAndLocalPrefixConfigurations = false;

    /**
     * Creates the properties.
     * 
     * @return the prefixed properties
     */
    protected synchronized PrefixedProperties createProperties() {
	if (myProperties == null) {
	    PrefixedProperties resultProperties = null;
	    String environment = defaultPrefix;
	    if (environmentFactory != null) {
		environment = environmentFactory.getEnvironment();
	    } else if (defaultPrefixSystemPropertyKey != null) {
		environment = System.getProperty(defaultPrefixSystemPropertyKey);
		if (environment == null) {
		    if (logger.isWarnEnabled()) {
			logger.warn(String.format(&quot;Didn't found system property key to set default prefix: %1s&quot;, defaultPrefixSystemPropertyKey));
		    }
		}
	    }
	    if (prefixConfigList != null) {
		resultProperties = PrefixedProperties.createCascadingPrefixProperties(prefixConfigList);
	    } else {
		if (environment != null) {
		    resultProperties = PrefixedProperties.createCascadingPrefixProperties(environment);
		} else {
		    resultProperties = new PrefixedProperties();
		}
	    }
	    resultProperties.setDefaultPrefix(environment);
	    if (logger.isInfoEnabled()) {
		logger.info(String.format(&quot;Setting default prefix to: %1s&quot;, environment));
	    }
	    resultProperties.setMixDefaultAndLocalPrefixSettings(mixDefaultAndLocalPrefixConfigurations);
	    myProperties = resultProperties;
	}
	return myProperties;
    }

    /**
     * Gets the effective properties.
     * 
     * @return the effective properties
     */
    @ManagedAttribute()
    public List&lt;String&gt; getEffectiveProperties() {
	final List&lt;String&gt; properties = new LinkedList&lt;String&gt;();
	for (final String key : myProperties.stringPropertyNames()) {
	    properties.add(key + &quot;=&quot; + myProperties.get(key));
	}
	return properties;
    }

    /**
     * Gets the prefixed properties.
     * 
     * @return the prefixed properties
     */
    public PrefixedProperties getPrefixedProperties() {
	return myProperties;
    }

    public boolean isMixDefaultAndLocalPrefixConfigurations() {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesFactoryBean.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesFactoryBean.html#169">169</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesPlaceholderConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesPlaceholderConfigurer.html#220">220</a></td></tr><tr class="b"><td colspan='2'><div><pre>			    logger.warn(&quot;Could not load properties from &quot; + location + &quot;: &quot; + ex.getMessage());
			}
		    } else {
			throw ex;
		    }
		} finally {
		    if (is != null) {
			is.close();
		    }
		}
	    }
	}
    }

    /* (non-Javadoc)
     * @see org.springframework.core.io.support.PropertiesLoaderSupport#mergeProperties()
     */
    @Override
    protected Properties mergeProperties() throws IOException {

	final PrefixedProperties myProperties = createProperties();

	if (localOverride) {
	    // Load properties from file upfront, to let local properties override.
	    loadProperties(myProperties);
	}
	if (localProperties != null) {
	    for (int i = 0; i &lt; localProperties.length; i++) {
		final Properties props = localProperties[i];
		if (props != null) {
		    for (final Enumeration&lt;Object&gt; en = props.keys(); en.hasMoreElements();) {
			final Object key = en.nextElement();
			myProperties.put(key, props.get(key));
		    }
		}
	    }
	}
	if (!localOverride) {
	    // Load properties from file afterwards, to let those properties override.
	    loadProperties(myProperties);
	}

	return myProperties;
    }</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesFactoryBean.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesFactoryBean.html#120">120</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertyOverrideConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertyOverrideConfigurer.html#150">150</a></td></tr><tr class="b"><td colspan='2'><div><pre>    }

    @Override
    protected void loadProperties(final Properties props) throws IOException {
	if (locations != null) {
	    for (int i = 0; i &lt; locations.length; i++) {
		final Resource location = locations[i];
		if (logger.isInfoEnabled()) {
		    logger.info(&quot;Loading properties file from &quot; + location);
		}
		File file = null;
		InputStream is = null;
		try {
		    try {
			file = location.getFile();
			is = new BufferedInputStream(new FileInputStream(file));
		    } catch (final IOException ie) {//ignore
		    } finally {
			if (file == null) {
			    is = location.getInputStream();
			}
		    }

		    if (location.getFilename().toLowerCase().endsWith(Constants.XML_FILE_EXTENSION)) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesFactoryBean.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesFactoryBean.html#204">204</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertyOverrideConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertyOverrideConfigurer.html#226">226</a></td></tr><tr class="b"><td colspan='2'><div><pre>	    }
	}

	if (!localOverride) {
	    loadProperties(myProperties);
	}

	return myProperties;
    }

    /**
     * Sets the default prefix.
     * 
     * @param defaultPrefix
     *            the new default prefix
     */
    public void setDefaultPrefix(final String defaultPrefix) {
	this.defaultPrefix = defaultPrefix;
    }

    /**
     * Sets this method to specify a system property to be used as an environment. The value of the property will be used for setting the default prefix.
     * {@link PrefixedProperties#setDefaultPrefix(String)}
     * 
     * @param defaultPrefixSystemPropertyKey
     *            the new ddefault prefix system property key
     */
    public void setDefaultPrefixSystemPropertyKey(final String defaultPrefixSystemPropertyKey) {
	this.defaultPrefixSystemPropertyKey = defaultPrefixSystemPropertyKey;
    }

    /**
     * Sets the environment factory.
     * 
     * @param environmentFactory
     *            the new environment factory
     */
    public void setEnvironmentFactory(final EnvironmentFactory environmentFactory) {
	this.environmentFactory = environmentFactory;
    }

    /**
     * Set the encoding to use for parsing properties files.
     * &lt;p&gt;
     * Default is none, using the &lt;code&gt;java.util.Properties&lt;/code&gt; default encoding.
     * &lt;p&gt;
     * Only applies to classic properties files, not to XML files.
     * 
     * @param encoding
     *            the new file encoding
     * @see org.springframework.util.PropertiesPersister#load
     */
    @Override
    public void setFileEncoding(final String encoding) {
	fileEncoding = encoding;
    }

    /**
     * Set if failure to find the property resource should be ignored.
     * &lt;p&gt;
     * &quot;true&quot; is appropriate if the properties file is completely optional. Default is &quot;false&quot;.
     * 
     * @param ignoreResourceNotFound
     *            the new ignore resource not found
     */
    @Override
    public void setIgnoreResourceNotFound(final boolean ignoreResourceNotFound) {
	this.ignoreResourceNotFound = ignoreResourceNotFound;
    }

    /* (non-Javadoc)
     * @see org.springframework.core.io.support.PropertiesLoaderSupport#setLocalOverride(boolean)
     */
    @Override
    public void setLocalOverride(final boolean localOverride) {
	this.localOverride = localOverride;
    }

    /**
     * Set a location of a properties file to be loaded.
     * &lt;p&gt;
     * Can point to a classic properties file or to an XML file that follows JDK 1.5's properties XML format.
     * 
     * @param location
     *            the new location
     */
    @Override
    public void setLocation(final Resource location) {
	locations = new Resource[] { location };
    }</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesFactoryBean.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesFactoryBean.html#153">153</a></td></tr><tr class="a"><td>net\sf\prefixedproperties\spring\PrefixedPropertiesPlaceholderConfigurer.java</td><td><a href="./xref/net/sf/prefixedproperties/spring/PrefixedPropertiesPlaceholderConfigurer.html#204">204</a></td></tr><tr class="b"><td colspan='2'><div><pre>		    } else if (location.getFilename().toLowerCase().endsWith(Constants.JSON_FILE_EXTENSION)) {
			if (fileEncoding != null) {
			    persister.loadFromJson(props, new InputStreamReader(is, Charset.forName(fileEncoding)));
			} else {
			    persister.loadFromJson(props, is);
			}
		    } else {
			if (fileEncoding != null) {
			    persister.load(props, new InputStreamReader(is, Charset.forName(fileEncoding)));
			} else {
			    persister.load(props, is);
			}
		    }
		} catch (final IOException ex) {
		    if (ignoreResourceNotFound) {
			if (logger.isWarnEnabled()) {
			    logger.warn(&quot;Could not load properties from &quot; + location + &quot;: &quot; + ex.getMessage());</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2010-2015.
          All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
